!function(win,doc){if("undefined"==typeof erej)return void alert("please import erej.js before this one");var xmlhttp,options,_self,createAjax=function(){var t;try{return t=new XMLHttpRequest}catch(e){try{return t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return t=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}}return!1},constructUrl=function(t,e){if(!erej.isObject(e))return t;var o=Ajax.buildUrlParms(e),n=erej.s(t);return n.contain("?")?(""==n.split("?")[1]||n.endWith("&")||(n=n.append("&")),n.append(o).toString()):n.append("?").append(o).toString()},onAjaxSuccess=function(t,e){erej.isFunction(options.success)&&options.success.call(_self,t,e,xmlhttp),onAjaxComplete(e)},onAjaxError=function(t,e){erej.isFunction(options.error)&&options.error.call(_self,t,e,xmlhttp),onAjaxComplete(e)},onAjaxComplete=function(t){erej.isFunction(options.complete)&&options.complete.call(_self,t,xmlhttp)},getAjaxHeaders=function(){var t={};if(!xmlhttp)return t;var e=xmlhttp.getAllResponseHeaders(),o=erej.s(e).toLower().split("\n");return erej.each(o,function(e){if(""!=erej.s(e).trim()){var o=e.split(":");t[o[0]]=erej.s(o[1]).trim().toString()}}),t},isResponseJson=function(){var t=getAjaxHeaders();return erej.s(t["content-type"]).contain("application/json")?!0:!1},runAsAjax=function(){return(xmlhttp=createAjax())?(xmlhttp.onreadystatechange=function(){if(4==xmlhttp.readyState){var status=xmlhttp.status;if(isResponseJson()){var res={};try{res=JSON.parse(xmlhttp.responseText)}catch(e){try{res=eval("("+xmlhttp.responseText+")")}catch(e){return void onAjaxError("Invalid Json string:\n"+xmlhttp.responseText,0)}}onAjaxSuccess(res,xmlhttp.status)}else onAjaxSuccess(xmlhttp.responseText,xmlhttp.status)}},erej.isNumber(options.timeout)&&options.timeout>0&&setTimeout(function(){4!=xmlhttp.readyState&&(_self.abort(),onAjaxError("Ajax time out",0))},options.timeout),"GET"==options.type?(xmlhttp.open(options.type,constructUrl(options.url,options.data),!0),xmlhttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded")):xmlhttp.open(options.type,options.url,!0),void xmlhttp.send("POST"==options.type?options.data:null)):void onAjaxError("浏览器不支持Ajax请求",0)},runAsJsonp=function(){if("GET"!=options.type)return void onAjaxError("Jsonp只支持GET请求方式",0);var t,e=constructUrl(options.url,options.data),o="callback"+Math.floor(1e6*Math.random()),n=function(){delete window[o],$(t).remove()};window[o]=function(t){onAjaxSuccess(t,200),n()},erej.isNumber(options.timeout)&&options.timeout>0&&setTimeout(function(){erej.isFunction(window[o])&&(window[o]=n,onAjaxError("Jsonp time out",0))},options.timeout),e=constructUrl(e,{callback:o}),t=erej.include(e,"js")},Ajax=function(t){return new Ajax.init(t)};Ajax.init=function(t){_self=this,options={type:t.type||"GET",url:t.url,data:t.data,success:t.success,error:t.error,complete:t.complete,timeout:t.timeout,jsonp:t.jsonp},options.jsonp?runAsJsonp():runAsAjax()},Ajax.init.prototype={abort:function(){if(xmlhttp)try{xmlhttp.abort()}catch(t){}}},Ajax.buildUrlParms=function(t){if(!erej.isDefined(t))return"";var e=[];for(var o in t)e.push(encodeURIComponent(o)+"="+encodeURIComponent(t[o]));return e.join("&")},erej.ajax=Ajax}(window,document);
//# sourceMappingURL=erej.ajax.min.js.map