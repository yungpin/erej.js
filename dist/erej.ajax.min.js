/**
 * @preserve
 *
 * Created by yungpin on 15/9/10.
 *
 * erej.ajax.js v1.1
 *
 * a personal website js library
 *
 * @author: yungping
 * @website: http://www.erej.net
 * @update: 2015-9-11 12:10:48
 */
!function(win,doc){if("undefined"==typeof erej)return void alert("please import erej.js before this one");var createAjax=function(){var e;try{return e=new XMLHttpRequest}catch(t){try{return e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{return e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}}return!1},constructUrl=function(e,t){if(!erej.isObject(t))return e;var o=Ajax.buildUrlParms(t),n=erej.s(e);return n.contain("?")?(""==n.split("?")[1]||n.endWith("&")||(n=n.append("&")),n.append(o).toString()):n.append("?").append(o).toString()},onAjaxSuccess=function(e,t,o){o.success&&o.success.call(o.ajax,e,t,o.xhr),onAjaxComplete(t,o)},onAjaxError=function(e,t,o){o.error&&o.error.call(o.ajax,e,t,o.xhr),onAjaxComplete(t,o)},onAjaxComplete=function(e,t){t.complete&&t.complete.call(t.ajax,e,t.xhr)},getAjaxHeaders=function(e){var t={};if(!e.xhr)return t;var o=e.xhr.getAllResponseHeaders(),n=erej.s(o).toLower().split("\n");return erej.each(n,function(e){if(""!=erej.s(e).trim()){var o=e.split(":");t[o[0]]=erej.s(o[1]).trim().toString()}}),t},isResponseJson=function(e){var t=getAjaxHeaders(e);return erej.s(t["content-type"]).contain("application/json")?!0:!1},runAsAjax=function(options){if(options.xhr=createAjax(),!options.xhr)return void onAjaxError("浏览器不支持Ajax请求",0,options);if(options.xhr.onreadystatechange=function(){if(4==options.xhr.readyState){var status=options.xhr.status;if(isResponseJson(options)){var res={};try{res=JSON.parse(options.xhr.responseText)}catch(e){try{res=eval("("+options.xhr.responseText+")")}catch(e){return void onAjaxError("Invalid Json string:\n"+options.xhr.responseText,0,options)}}onAjaxSuccess(res,options.xhr.status,options)}else onAjaxSuccess(options.xhr.responseText,options.xhr.status,options)}},erej.isNumber(options.timeout)&&options.timeout>0&&setTimeout(function(){4!=options.xhr.readyState&&(options.ajax.abort(),onAjaxError("Ajax time out",0,options))},options.timeout),"GET"==options.type?(options.xhr.open(options.type,constructUrl(options.url,options.data),!0),options.xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded")):options.xhr.open(options.type,options.url,!0),"POST"==options.type){var d=options.data;!erej.isObject(d)||!erej.isDefined(win.FormData)||d instanceof FormData||(d=Ajax.buildUrlParms(d),options.xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded")),options.xhr.send(d)}else options.xhr.send(null)},runAsJsonp=function(e){if("GET"!=e.type)return void onAjaxError("Jsonp只支持GET请求方式",0,e);var t,o=constructUrl(e.url,e.data),n="callback"+Math.floor(1e6*Math.random()),r=function(){delete win[n],$(t).remove()};win[n]=function(e){onAjaxSuccess(e,200),r()},erej.isNumber(e.timeout)&&e.timeout>0&&setTimeout(function(){erej.isFunction(win[n])&&(win[n]=r,onAjaxError("Jsonp time out",0,e))},e.timeout),o=constructUrl(o,{callback:n}),t=erej.include(o,"js")},Ajax=function(e){return new Ajax.init(e)};Ajax.init=function(e){var t,o=this;return erej.isObject(e)?(t={type:e.type||"GET",url:e.url,data:e.data,success:erej.isFunction(e.success)?e.success:null,error:erej.isFunction(e.error)?e.error:null,complete:erej.isFunction(e.complete)?e.complete:null,timeout:e.timeout,jsonp:e.jsonp},t.ajax=o,t.jsonp?runAsJsonp(t):runAsAjax(t),o.options=t,o):!1},Ajax.init.prototype={abort:function(){if(this.options.xhr)try{this.options.xhr.abort()}catch(e){}}},Ajax.buildUrlParms=function(e){if(!erej.isDefined(e))return"";var t=[];for(var o in e)t.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return t.join("&")},erej.ajax=Ajax}(window,document);
//# sourceMappingURL=erej.ajax.min.js.map